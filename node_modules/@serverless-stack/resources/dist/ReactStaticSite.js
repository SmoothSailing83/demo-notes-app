"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.ReactStaticSite = void 0;
const path = __importStar(require("path"));
const fs = __importStar(require("fs-extra"));
const StaticSite_1 = require("./StaticSite");
/////////////////////
// Construct
/////////////////////
class ReactStaticSite extends StaticSite_1.StaticSite {
    constructor(scope, id, props) {
        const { path: sitePath, environment } = props || {};
        // Validate environment
        Object.keys(environment || {}).forEach((key) => {
            if (!key.startsWith("REACT_APP_")) {
                throw new Error(`Environment variables in the "${id}" ReactStaticSite must start with "REACT_APP_".`);
            }
        });
        // generate buildCommand
        let defaultBuildCommand = "npm run build";
        if (fs.existsSync(path.join(sitePath, "yarn.lock"))) {
            defaultBuildCommand = "yarn build";
        }
        super(scope, id, Object.assign({ indexPage: "index.html", errorPage: StaticSite_1.StaticSiteErrorOptions.REDIRECT_TO_INDEX_PAGE, buildCommand: defaultBuildCommand, buildOutput: "build", fileOptions: [
                {
                    exclude: "*",
                    include: "*.html",
                    cacheControl: "max-age=0,no-cache,no-store,must-revalidate",
                },
                {
                    exclude: "*",
                    include: ["*.js", "*.css"],
                    cacheControl: "max-age=31536000,public,immutable",
                },
            ] }, props));
    }
}
exports.ReactStaticSite = ReactStaticSite;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUmVhY3RTdGF0aWNTaXRlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL1JlYWN0U3RhdGljU2l0ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsMkNBQTZCO0FBQzdCLDZDQUErQjtBQUcvQiw2Q0FJc0I7QUFXdEIscUJBQXFCO0FBQ3JCLFlBQVk7QUFDWixxQkFBcUI7QUFFckIsTUFBYSxlQUFnQixTQUFRLHVCQUFVO0lBQzdDLFlBQVksS0FBb0IsRUFBRSxFQUFVLEVBQUUsS0FBc0I7UUFDbEUsTUFBTSxFQUFFLElBQUksRUFBRSxRQUFRLEVBQUUsV0FBVyxFQUFFLEdBQUcsS0FBSyxJQUFJLEVBQUUsQ0FBQztRQUVwRCx1QkFBdUI7UUFDdkIsTUFBTSxDQUFDLElBQUksQ0FBQyxXQUFXLElBQUksRUFBRSxDQUFDLENBQUMsT0FBTyxDQUFDLENBQUMsR0FBRyxFQUFFLEVBQUU7WUFDN0MsSUFBSSxDQUFDLEdBQUcsQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLEVBQUU7Z0JBQ2pDLE1BQU0sSUFBSSxLQUFLLENBQ2IsaUNBQWlDLEVBQUUsaURBQWlELENBQ3JGLENBQUM7YUFDSDtRQUNILENBQUMsQ0FBQyxDQUFDO1FBRUgsd0JBQXdCO1FBQ3hCLElBQUksbUJBQW1CLEdBQUcsZUFBZSxDQUFDO1FBQzFDLElBQUksRUFBRSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxXQUFXLENBQUMsQ0FBQyxFQUFFO1lBQ25ELG1CQUFtQixHQUFHLFlBQVksQ0FBQztTQUNwQztRQUVELEtBQUssQ0FBQyxLQUFLLEVBQUUsRUFBRSxrQkFDYixTQUFTLEVBQUUsWUFBWSxFQUN2QixTQUFTLEVBQUUsbUNBQXNCLENBQUMsc0JBQXNCLEVBQ3hELFlBQVksRUFBRSxtQkFBbUIsRUFDakMsV0FBVyxFQUFFLE9BQU8sRUFDcEIsV0FBVyxFQUFFO2dCQUNYO29CQUNFLE9BQU8sRUFBRSxHQUFHO29CQUNaLE9BQU8sRUFBRSxRQUFRO29CQUNqQixZQUFZLEVBQUUsNkNBQTZDO2lCQUM1RDtnQkFDRDtvQkFDRSxPQUFPLEVBQUUsR0FBRztvQkFDWixPQUFPLEVBQUUsQ0FBQyxNQUFNLEVBQUUsT0FBTyxDQUFDO29CQUMxQixZQUFZLEVBQUUsbUNBQW1DO2lCQUNsRDthQUNGLElBQ0UsS0FBSyxFQUNSLENBQUM7SUFDTCxDQUFDO0NBQ0Y7QUF2Q0QsMENBdUNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICogYXMgcGF0aCBmcm9tIFwicGF0aFwiO1xuaW1wb3J0ICogYXMgZnMgZnJvbSBcImZzLWV4dHJhXCI7XG5pbXBvcnQgKiBhcyBjZGsgZnJvbSBcIkBhd3MtY2RrL2NvcmVcIjtcblxuaW1wb3J0IHtcbiAgU3RhdGljU2l0ZSxcbiAgU3RhdGljU2l0ZVByb3BzLFxuICBTdGF0aWNTaXRlRXJyb3JPcHRpb25zLFxufSBmcm9tIFwiLi9TdGF0aWNTaXRlXCI7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gSW50ZXJmYWNlc1xuLy8vLy8vLy8vLy8vLy8vLy8vLy8vXG5cbi8qKlxuICogQGRlcHJlY2F0ZWQgVGhpcyB0eXBlIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IHRoZSBzdGFuZGFyZCBTdGF0aWNTaXRlUHJvcHNcbiAqL1xuZXhwb3J0IHR5cGUgUmVhY3RTdGF0aWNTaXRlUHJvcHMgPSBTdGF0aWNTaXRlUHJvcHM7XG5cbi8vLy8vLy8vLy8vLy8vLy8vLy8vL1xuLy8gQ29uc3RydWN0XG4vLy8vLy8vLy8vLy8vLy8vLy8vLy9cblxuZXhwb3J0IGNsYXNzIFJlYWN0U3RhdGljU2l0ZSBleHRlbmRzIFN0YXRpY1NpdGUge1xuICBjb25zdHJ1Y3RvcihzY29wZTogY2RrLkNvbnN0cnVjdCwgaWQ6IHN0cmluZywgcHJvcHM6IFN0YXRpY1NpdGVQcm9wcykge1xuICAgIGNvbnN0IHsgcGF0aDogc2l0ZVBhdGgsIGVudmlyb25tZW50IH0gPSBwcm9wcyB8fCB7fTtcblxuICAgIC8vIFZhbGlkYXRlIGVudmlyb25tZW50XG4gICAgT2JqZWN0LmtleXMoZW52aXJvbm1lbnQgfHwge30pLmZvckVhY2goKGtleSkgPT4ge1xuICAgICAgaWYgKCFrZXkuc3RhcnRzV2l0aChcIlJFQUNUX0FQUF9cIikpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFxuICAgICAgICAgIGBFbnZpcm9ubWVudCB2YXJpYWJsZXMgaW4gdGhlIFwiJHtpZH1cIiBSZWFjdFN0YXRpY1NpdGUgbXVzdCBzdGFydCB3aXRoIFwiUkVBQ1RfQVBQX1wiLmBcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGdlbmVyYXRlIGJ1aWxkQ29tbWFuZFxuICAgIGxldCBkZWZhdWx0QnVpbGRDb21tYW5kID0gXCJucG0gcnVuIGJ1aWxkXCI7XG4gICAgaWYgKGZzLmV4aXN0c1N5bmMocGF0aC5qb2luKHNpdGVQYXRoLCBcInlhcm4ubG9ja1wiKSkpIHtcbiAgICAgIGRlZmF1bHRCdWlsZENvbW1hbmQgPSBcInlhcm4gYnVpbGRcIjtcbiAgICB9XG5cbiAgICBzdXBlcihzY29wZSwgaWQsIHtcbiAgICAgIGluZGV4UGFnZTogXCJpbmRleC5odG1sXCIsXG4gICAgICBlcnJvclBhZ2U6IFN0YXRpY1NpdGVFcnJvck9wdGlvbnMuUkVESVJFQ1RfVE9fSU5ERVhfUEFHRSxcbiAgICAgIGJ1aWxkQ29tbWFuZDogZGVmYXVsdEJ1aWxkQ29tbWFuZCxcbiAgICAgIGJ1aWxkT3V0cHV0OiBcImJ1aWxkXCIsXG4gICAgICBmaWxlT3B0aW9uczogW1xuICAgICAgICB7XG4gICAgICAgICAgZXhjbHVkZTogXCIqXCIsXG4gICAgICAgICAgaW5jbHVkZTogXCIqLmh0bWxcIixcbiAgICAgICAgICBjYWNoZUNvbnRyb2w6IFwibWF4LWFnZT0wLG5vLWNhY2hlLG5vLXN0b3JlLG11c3QtcmV2YWxpZGF0ZVwiLFxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgZXhjbHVkZTogXCIqXCIsXG4gICAgICAgICAgaW5jbHVkZTogW1wiKi5qc1wiLCBcIiouY3NzXCJdLFxuICAgICAgICAgIGNhY2hlQ29udHJvbDogXCJtYXgtYWdlPTMxNTM2MDAwLHB1YmxpYyxpbW11dGFibGVcIixcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgICAuLi5wcm9wcyxcbiAgICB9KTtcbiAgfVxufVxuIl19